## ä»ä¹æ¯NAT

NATï¼Network Address Translationï¼ç½ç»å°åæ å°ï¼ä¸»è¦æ¯å°ç§æ IP å°åè½¬æ¢æå¯ä»¥å¨å¬ç½ä½¿ç¨çå¬ç½ IP å°åãèè½å¤è¿è¡æ å°çç½ç»è£ç½®è¢«ç§°ä¸º NAT è·¯ç±ã

ä¹æä»¥éè¦NATï¼æ¯ä¸ºäºè§£å³ IPv4 å°åä¸å¤èè¯ççãéè¿å¬ç½ IP å°åä¸ç«¯å£æ å°å°ç§ç½æºå¨ç IP å°åä¸ç«¯å£ãè¿æ ·å°±è½éè¿å°éçå¬æ IP å°åæ¥ä»£è¡¨è¾å¤çç§æ IP å°åï¼æå©äºåç¼ IPv4 å°åçèå°½é®é¢ãå¦ä¸å¾ã


## NATçåç±»

NAT æåè½åæä¸¤å¤§ç±»ï¼é¥å NAT åå¯¹ç§°å NATã

æè°é¥å½¢NAT æ¯æï¼åªè¦æ¯ä»åä¸ä¸ªåé¨å°ååç«¯å£åºæ¥çåï¼æ è®ºç®çå°åæ¯å¦ç¸åï¼NAT é½å°å®è½¬æ¢æåä¸ä¸ªå¤é¨å°ååç«¯å£ã

âåä¸ä¸ªå¤é¨å°ååç«¯å£âä¸âæ è®ºç®çå°åæ¯å¦ç¸åâå½¢æäºä¸ä¸ªç±»ä¼¼é¥å½¢çç½ç»ç»æï¼ä¹æ¯è¿ä¸åç§°çç±æ¥ãåè¿æ¥ï¼ä¸æ»¡è¶³è¿ä¸æ¡ä»¶çå³ä¸ºå¯¹ç§°NAT ã

### Full Cone

å®å¨é¥å NATãIP åç«¯å£é½ä¸åéãè¡¨ç°å½¢å¼ï¼å°æ¥èªåé¨åä¸ä¸ª IP å°ååä¸ä¸ªç«¯å£çä¸»æºçå¬/è¯·æ±ï¼æ å°å°å¬ç½ IP æä¸ªç«¯å£ççå¬ãä»»æå¤é¨ IP å°åä¸ç«¯å£å¯¹å¶èªå·±å¬ç½ç IP è¿ä¸ªæ å°åçç«¯å£è®¿é®ï¼é½å°éæ°å®ä½å°åé¨è¿ä¸ªä¸»æºãè¯¥ææ¯ä¸­ï¼åºäº C/S æ¶æçåºç¨å¯ä»¥å¨ä»»ä½ä¸ç«¯åèµ·è¿æ¥ãç®åä¸ç¹çè¯´ï¼å°±æ¯åªè¦å®¢æ·ç«¯ç±åå°å¤å»ºç«ä¸ä¸ªæ å°ä¹åï¼å¶ä» IP çä¸»æºæç«¯å£é½å¯ä»¥ä½¿ç¨è¿ä¸ªæ´ç»å®¢æ·ç«¯åéæ°æ®ã

### Restricted Cone

åéé¥å NATãIP åéï¼ç«¯å£ä¸åéãè¡¨ç°å½¢å¼ï¼ä¸å®å¨é¥å½¢ NAT ä¸åçæ¯ï¼å¨å¬ç½æ å°ç«¯å£åï¼å¹¶ä¸åè®¸ææ IP è¿è¡å¯¹äºè¯¥ç«¯å£çè®¿é®ï¼è¦æ³éä¿¡å¿éåé¨ä¸»æºå¯¹æä¸ªå¤é¨ IP ä¸»æºåèµ·è¿è¿æ¥ï¼ç¶åè¿ä¸ªå¤é¨ IP ä¸»æºå°±å¯ä»¥ä¸è¯¥åé¨ä¸»æºéä¿¡äºï¼ä½ç«¯å£ä¸åéå¶ãä¸¾ä¸ªæ å­ï¼å½å®¢æ·ç«¯ç±åå°å¤å»ºç«æ å°ï¼A æºå¨å¯ä»¥ä½¿ç¨ä»çå¶ä»ç«¯å£ä¸»å¨è¿æ¥å®¢æ·ç«¯ï¼ä½ B æºå¨åä¸è¢«åè®¸ãå ä¸º IP åéå¦ï¼ä½æ¯ç«¯å£éä¾¿ã

### Port Restricted Cone

ç«¯å£åéå NATãIP åç«¯å£é½åéãè¡¨ç°å½¢å¼ï¼è¯¥ææ¯ä¸åéé¥å½¢ NAT ç¸æ¯æ´ä¸ºä¸¥æ ¼ãé¤å·æåéé¥å½¢ NAT ç¹æ§ï¼å¯¹äºåå¤ä¸»æºçç«¯å£ä¹æè¦æ±ãä¹å°±æ¯è¯´ï¼åªæå½åé¨ä¸»æºæ¾ç»åéè¿æ¥æç»å¤é¨ä¸»æºï¼åè®¾å¶ IP å°åä¸º A ä¸ç«¯å£ä¸º P1ï¼ä¹åï¼å¤é¨ä¸»æºæè½ä»¥å¬ç½ IPORT ä¸­çä¿¡æ¯ä½ä¸ºç®æ å°ååç®æ ç«¯å£ï¼ååé¨ä¸»æºåé UDP æ¥æï¼åæ¶ï¼å¶è¯·æ±æ¥æç IP å¿é¡»æ¯ Aï¼ç«¯å£å¿é¡»ä¸º P1ï¼ä½¿ç¨ IP å°åä¸º Aï¼ç«¯å£ä¸º P2ï¼æè IP å°åä¸º Bï¼ç«¯å£ä¸º P1 é½å°éä¿¡å¤±è´¥ï¼ãè¿ä¸è¦æ±è¿ä¸æ­¥å¼ºåäºå¯¹å¤é¨æ¥æè¯·æ±æ¥æºçéå¶ï¼å æ­¤å®æ¯åéé¥å NAT æ´å·å®å¨æ§ã

### Symmetric

å¯¹ç§°å NATãå¯¹æ¯ä¸ªå¤é¨ä¸»æºæç«¯å£çä¼è¯é½ä¼æ å°ä¸ºä¸åçç«¯å£ï¼æ´ï¼ãè¡¨ç°å½¢å¼ï¼åªææ¥èªåä¸åé¨ IPortãä¸éå¯¹åä¸ç®æ  IPORT çè¯·æ±æè¢« NAT è½¬æ¢è³åä¸ä¸ªå¬ç½ï¼å¤é¨ï¼IPortï¼å¦åçè¯ï¼NAT å°ä¸ºä¹åéä¸ä¸ªæ°çå¤é¨ï¼å¬ç½ï¼IPortãå¹¶ä¸ï¼åªææ¾ç»æ¶å°è¿åé¨ä¸»æºè¯·æ±çå¤é¨ä¸»æºæè½ååé¨ä¸»æºåéæ°æ®åãåé¨ä¸»æºç¨åä¸ IP ä¸åä¸ç«¯å£ä¸å¤é¨å¤ IP éä¿¡ãå®¢æ·ç«¯æ³åæå¡å¨ Aï¼IP_AORT_Aï¼å»ºç«è¿æ¥ï¼æ¯éè¿ NAT æ å°ä¸º NatIP:NatPortA æ¥è¿è¡çãèå®¢æ·ç«¯åæå¡å¨ Bï¼IP_BORT_Bï¼å»ºç«è¿æ¥ï¼æ¯éè¿ NAT æ å°ä¸º NatIP:NatPortB æ¥è¿è¡çãå³åä¸ä¸ªå®¢æ·ç«¯åä¸åçç®æ  IP:PORT éä¿¡ï¼ç»è¿ NAT æ å°åçå¬ç½ IP:PORT æ¯ä¸åçãæ­¤æ¶ï¼å¦æ B æ³è¦åå®¢æ·ç«¯éä¿¡ï¼ä¹åªè½éè¿ NatIP:NatPortB æ¥è¿è¡ï¼èä¸è½éè¿ NatIP:NatPortAãä»¥ä¸ï¼å°±æ¯åç§ NAT ç±»åãå¯ä»¥çåºä»ç±»å 1 è³ç±»å 4ï¼NAT çéå¶æ¯è¶æ¥è¶å¤§çï¼å¶ç©¿éä¹è¶æ¥è¶å¤æã


## UDPææ´(NAT traversal)

å¯¹äºUDPææ´ï¼æç®åä¹æå¸¸ç¨å°çå°±æ¯STUNäºï¼å³UDPå¯¹NATçç®åç©¿è¶æ¹å¼ãç®åæ¥è¯´å°±æ¯å®¢æ·ç«¯å

