# Linux安全：AppArmor


## 简介

AppArmor是一项安全功能，可以在许多Linux发行版中找到。SLES（SUSE Linux Enterprise Server），openSUSE和Ubuntu是附带该产品的一些发行版。

同SELinux，Apparmor也是内核增强功能，旨在将程序限制在有限的资源集中。由于 AppArmor 和 SELinux 使用了同样的框架，所以它们可以互换。AppArmor 的开发初衷是因为人们认为 SELinux 太过复杂，不适合普通用户管理。Apparmor与其他安全工具的不同之处在于，它将访问控制属性绑定到程序而不是单个用户。

与SELinux相比，优势在于其易用性，实现同样的功能限制，会比使用SELinux的规则代码少很多；而且从代码的可读性上来看，apparmor的代码也更易理解和易读。

从安全性上来说，毋庸置疑，SELinux更安全。从理论上也可以了解到SELinux与Apparmor最大的区别在于：Apparmor使用文件名（路径名）最为安全标签，而SELinux使用文件的inode作为安全标签，这就意味着，Apparmor机制可以通过修改文件名而被绕过，另外，在文件系统中，只有inode才具有唯一性。


## 相关概念

Apparmor的限制是由加载到内核中的特殊配置文件提供的。这些配置文件可以在两种模式下运行：complain mode或enforce mode。

* Enforcement(强制): 以enforce模式加载的配置文件将导致配置文件中定义的策略被强制执行，同时对于违反这些限制条件的程序会进行日志记录（通过 syslog 或 auditd）。
* Complain(投诉): Complain模式下的配置文件不会强制执行策略，而是报告违反策略的尝试，不会对程序的行为进行限制，只是进行记录。

## 使用

#### 文件系统的访问控制

#### 常用命令

相关软件包 `apparmor-profiles`, `apparmor-utils`
* apparmor_status: 看AppArmor配置文件的当前状态的
* apparmor_parser: 这个就是将AppArmor配置文件直接加载到内核
* aa-complain: 这个可以把AppArmor配置文件设置为complain模式
* aa-enforce: 将AppArmor配置文件设置为enforce模式

## 相关链接

* [Apparmor的绕过](https://zhuanlan.zhihu.com/p/457269937)
* [什么是AppArmor，以及如何保持Ubuntu安全？](https://mos86.com/82456.html)
* [在 Linux 上用 SELinux 或 AppArmor 实现强制访问控制（MAC）](https://mp.weixin.qq.com/s?src=3&timestamp=1652624506&ver=1&signature=V-NSaVpqkPFm98fJar4RlRl3EZJ5SR5jX7ZwXr0Z8m8y2dkosOUjvJkE3ng19ss5mFWQZaI2kLLkP1SIVjT7qF*UYqw5cyM-NW5XFptVOTc6KwTFLyQTVlcZuuHrAvXwOvFEK*EvKCgI0SZXyWYH0tUR2AhUae8WpJSVTdQ2w2Y=)

* https://zhuanlan.zhihu.com/p/457269937
* https://mos86.com/82456.html
